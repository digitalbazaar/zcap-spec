<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <title>Linked Data Object Capabilities</title>
    <script 
        src='https://www.w3.org/Tools/respec/respec-w3c-common' 
        class='remove'></script>
    <script class='remove'>
     var respecConfig = {
         specStatus: "CG-DRAFT",
         editors: [
             {name: "Manu Sporny",
              url: "http://digitalbazaar.com/",
              company: "Digital Bazaar",
              companyURL: "http://digitalbazaar.com/"},
             {name: "Christopher Lemmer Webber",
              url: "https://dustycloud.org/",
              company: "Spec-Ops",
              companyURL: "https://www.spec-ops.io/"}],
         authors: [
             {name: "Manu Sporny",
              url: "http://digitalbazaar.com/",
              company: "Digital Bazaar",
              companyURL: "http://digitalbazaar.com/"},
             {name: "Christopher Lemmer Webber",
              url: "https://dustycloud.org/",
              company: "Spec-Ops",
              companyURL: "https://www.spec-ops.io/"},
             {name: "Mark S. Miller",
              url: "http://www.erights.org/talks/thesis/"}],
         processVersion: 2017,
         edDraftURI: "https://w3c-ccg.github.io/ld-ocap/",
         shortName: "ld-ocap",

         //// CCG needs to approve this as a work item first :)
         // // name of the WG
         // wg:           "Credentials Community Group",
         // 
         // // URI of the public WG page
         // wgURI:        "https://www.w3.org/community/credentials/",
         // 
         // // name (with the @w3c.org) of the public mailing to which comments are due
         // wgPublicList: "public-credentials",
     };
    </script>
  </head>
  <!-- Style guide for this document:
        - Indent tags appropriately according to nesting depth
        - Newline after every sentence (this helps making reading git diffs
          easier, as well as merging in complicated changes, because a change
          will only affect a sentence at a time rather than a complete
          paragraph)
        - Wrap text at column 79 (the least critical of the three conventions
          since this merely helps the text look nicer in many text editors)
     -->
  <body>
    <section id='abstract'>
      <p>
        Linked Data Capabilities (<code>ld-ocap</code> for short) provide a
        secure way for linked data systems to grant and express authority
        utilizing the
        <a href="https://en.wikipedia.org/wiki/Object-capability_model">
          object capability model</a>.
        Capabilities are expressed through "proclamation chains" which are
        themselves linked data documents signed through
        <a href="https://w3c-dvcg.github.io/ld-signatures/">
          Linked Data Signatures</a>.
        Linked Data Capabilities support delegating authority to other entities
        on the network.
        "Caveats" may be attached to proclamations which may be used to
        restrict the scope of their use, for example to restrict the methods
        which may be used or providing a mechanism by which the capability may
        be later revoked.
      </p>
    </section>
    <section id='sotd'>
      <p>
        This specification is currently being drafted to be considered as a
        work item for the
        <a href="https://w3c-ccg.github.io/">Community Credentials Group</a>.
      </p>
    </section>
    <section id="introduction">
      <h2>Introduction</h2>
      <p><i>
        This document is being based off of a
        <a href="https://github.com/WebOfTrustInfo/rebooting-the-web-of-trust-fall2017/blob/master/draft-documents/lds-ocap/lds-ocap.md">paper from Rebooting Web of Trust</a>.
        In the early stages of this document some ideas may be better
        described in that paper than yet in this specification.
      </i></p>

      <p>
        This document does not cover a specific method for delivering
        Linked Data Capabilities to an object, though something like
        the inbox property and associated delivery mechanisms from
        Linked Data Notifications and ActivityPub is one possible
        system.
        However there is nothing about Linked Data Capabilities that is
        specific to HTTP; for example, both proclamations and invocations
        could be stored on a blockchain or a distributed hash table.
      </p>

      <section id="ocap-by-example">
        <p>
          Much of modern computing security infrastructure relies on "who is
          doing something" using access control lists.
          For example, our friend Alyssa P. Hacker has a car, and she would
          like to drive it
          In the access control list world, the car itself may scan Alyssa's
          face, determine that Alyssa is the driver, and say "Welcome Alyssa,
          you are now free to drive."
          Talking cars are appealing and fun, but Alyssa may run into
          challenges when she would like to allow others to drive her car.
        </p>

        <p>
          Fortunately, there is another paradigm that is even more familiar to
          the car scenario, but less familiar in the context of computing,
          despite providing some superior properties and a greater degree
          of safety: object capabilities.
          Object capabilities focus not on "who" is peforming an action, but
          upon "what" source of authority permits an action to occur.
          As it turns out, Alyssa does not have a talking and face-scanning
          car, she has a car that accepts a key.
          The car may have no memory of Alyssa whatsoever, but as long as
          Alyssa holds the kind of key that enables her to drive the car,
          she can drive the car.
          Capabilities are very similar to this car metaphor, and we can encode
          this same idea in Linked Data Capabilities as a "proclamation":
        </p>

        <pre class="example highlight json">
    {"@context": ["https://example.org/ocap/v1",
                  "https://autopower.example/"],
     "id": "https://whatacar.example/a-fancy-car/proc/7a397d7b",
     "type": "Proclamation",
     
     // The subject is who the capability operates on (in this case,
     // Alyssa's Car)
     "subject": "https://whatacar.example/a-fancy-car",

     // We are granting access specifically to one of Alyssa's keys
     "grantedKey": "https://social.example/alyssa/#key-for-car",

     // Finally we sign this object with one of the Alyssa's Car's keys
     "signature": {
        "type": "RsaSignature2016",
        "created": "2016-02-08T16:02:20Z",
        "creator": "https://whatacar.example/a-fancy-car#key-1",
        "signatureValue": "IOmA4R7TfhkYTYW8...CBMq2/gi25s="}}
        </pre>

        <p>
          This proclamation signs that one of Alyssa's keys (rather than
          Alyssa specifically) is able to drive the car.
          Turning on this car and driving into the sunset is as easy as
          invoking the capability to do so:
        </p>

        <pre class="example highlight json">
    {"@context": ["https://example.org/ocap/v1",
                  "https://autopower.example/"],
     "id": "urn:uuid:ad86cb2c-e9db-434a-beae-71b82120a8a4",
     "type": "Invocation",
     "proclamation": "https://whatacar.example/a-fancy-car/proc/7a397d7b",
     "method": "Drive",
     "signature": {
        "type": "RsaSignature2016",
        "created": "2016-02-08T17:13:48Z",
        "creator": "https://social.example/alyssa/#key-for-car",
        "signatureValue": "..."}}
        </pre>

        <p>
          Alyssa lives with her roommate and long-time friend Ben Bitdiddle.
          While they're living together, she'd like that he be able to drive
          her car too.
          Capabilities support delegation, so she could delegate a new
          capability to Ben giving him full access, not unlike going to the
          hardware store and having them copy the key.
          But Alyssa knows that she and Ben will probably not be roommates
          forever, and she feels no need for him to be able to drive her car
          once they are not, so she would like to have the option to revoke
          his access.
          In the world of object capabilities, this is entirely possible by
          adding a "caveat" that permits future revocation.
          We can imagine this to be like a new key that has a remote
          destruction mechanism: Alyssa can press a button that she has,
          a wire burns out inside the key, and the key will not be usable
          anymore.
          Alyssa generates a new proclamation that points at the proclamation
          she has, adding the caveat:
        </p>

        <pre class="example highlight json">
    {"@context": ["https://example.org/ocap/v1",
                  "https://autopower.example/"],
     "id": "https://social.example/alyssa/prcmtns#79795d78",
     "type": "Proclamation",

     // Pointing up the chain at the proclamation from which Alyssa
     // initially gained access
     "parentProclamation": "https://whatacar.example/a-fancy-car/proc/7a397d7b",

     // Alyssa grants access specifically to one of Ben's keys
     "grantedKey": "https://chatty.example/ben/#key-33",

     // Alyssa adds a caveat: Ben can drive her car, unless she flips
     // the bit at this url
     "caveat": [
       {"type": "ValidWhileTrue",
        "uri": "https://social.example/alyssa/ben-can-still-drive"}],

     // Finally Alyssa signs this object with the key she was granted
     // access with
     "signature": {
        "type": "RsaSignature2016",
        "created": "2017-03-28T06:01:25Z",
        "creator": "https://social.example/alyssa/#key-for-car",
        "signatureValue": "..."}}
        </pre>

        <p>
          
        </p>


        <!--
           - Alyssa has a car: ocap edition

           - Alyssa wants to let her roommate/friend Ben drive, she delegates a
             capability to him.  Alyssa trusts Ben, but decides it's her car, so
             she wants the ability to change her mind if for example they are no
             longer roommates, so she adds a caveat that says that Ben can drive
             the car unless Alyssa revokes that permission

           - Ben drives to an event with valet parking.  Lem E. Driveit, the
             valet, asks for Ben's key so that he may park the car, but Ben
             decides that it would be most responsible for him to make sure that
             Lem can't take Alyssa's car for a joyride, so when delegating a
             capability to drive Alyssa's car, he adds an additional caveat:
             this valet-key capability can only be driven for five kilometers,
             which is long enough to park a car with some buffer, but short
             enough to not permit Lem to take a joy ride.

           - Alyssa has a car: ACL edition

           - The ability to delegate and add caveats are wonderful features.
             However, they aren't the only reason to choose Capabilities over ACLs...
           -->
      </section>

    </section>
    <section id="terminology">
      <h2>Terminology</h2>
      <!-- TODO: Add introductory paragraph to this section -->
      <dl>
        <dt>capability</dt>
        <dd>
          Authority which may be invoked to perform some operation upon a
          (linked data) object.
          Represented as a proclamation chain within the context of
          Linked Data Capabilities.
        </dd>

        <dt>caveat</dt>
        <dd>
          Also known as "attenuation" within object capability literature,
          a "caveat" may be attached to a proclamation as a restriction on
          how that capability may be used.
          Delegated capabilities will preserve caveats and may be themselves
          may be further restricted by adding more caveats.
        </dd>

        <dt>invocation</dt>
        <dd>
          The "activation" of a capability, represented as a linked data
          document which is signed in such a way that matches authority
          granted through a prior proclamation.
          <!-- TODO: fix up awkward wording here -->
          An invocation may have arguments, similar to how a procedure call
          may have arguments.
        </dd>

        <!-- TODO: Maybe this should be removed, because it's hard not
           to use object in other ways-->
        <dt>object</dt>
        <dd>
          Though the term object has
          <a href="http://mumble.net/~jar/articles/oo.html">many definitions</a>
          in computer science, within the context of Linked Data Capabilities
          a "linked data object" is an entity which is associated with a URI and
          which is capable of having proclamation chain based capabilities
          being invoked against it.
        </dd>

        <dt>method</dt>
        <dd>
          An argument of an invocation which directs what particular
          functionality of the object is being used.
          For example, an invocation against a file storage service
          may specify either a write method or a read method.
        </dd>

        <dt>proclamation / proclamation chain</dt>
        <dd>
          A proclamation is a linked data document which represents a
          capability to an object.
          Proclamations may be delegated by issuing new proclamations
          which point at previous proclamations, possibly with further
          caveats attached.
        </dd>

        <dt>subject</dt>
        <dd>
          TODO
        </dd>
      </dl>
    </section>

    <section id="proclamations">
      <h2>Proclamations</h2>

      <p>
        Linked Data Capabilities are encoded through "proclamation chains".
        Proclamations are linked data documents which express a grant
        of authority from some entity (or more commonly, an entitiy's
        specific key) to a specific subject, possibly restricted
        through "caveats".
        (This includes the possibility of revocation through a caveat
        that expresses such a mechanism.)
      </p>

      <p>
        Every proclamation MUST have:
      </p>
      
      <ul>
        <!-- TODO: What's the right way to say this?
             This sounds very json-ld centric -->
        <li>an associated <code>id</code></li>
        <li>the <code>type</code> set to <code>Proclamation</code></li>
        <li>
          a <code>signature</code> field, which MUST sign the document with
          <a href="https://w3c-dvcg.github.io/ld-signatures/">
            Linked Data Signatures</a>
          by one of the <code>subject</code>'s keys, or if this proclamation is
          being delegated through the <code>parentProclamation</code> property,
          by one of the keys granted access to this capability through the
          <code>grantedKey</code> property.
          <!-- TODO: Should this be by any of the keys which have authority
               to use this capability, or only the nearest grantedKey on the
               chain? -->
        </li>
      </ul>

      <p>
        "Top-level" proclamations, which do not have a
        <code>parentProclamation</code> property, MUST have:
      </p>

      <ul>
        <li>
          a <code>subject</code>, which links to a linked data object
          to which this capability grants the authority to invoke
          operations upon
        </li>
        <li>
          <code>grantedKey</code>, which links to one or more keys
          being granted authority to use this capability
          (child proclamations MAY also have this property)
        </li>
      </ul>

      <div class="note">
        <p>
          Why don't all child proclamations require a grantedKey property?
          The reason is that it is perfectly reasonable for an entity which has
          access to a capability to give an attenuated capability to
          <em>itself</em> to be used in a specific context.
        </p>
        <p>
          Capabilities are not structured around "who has access" to something
          but rather holding onto a capability for a particular use, and in
          order to avoid confused deputy and ambient authority problems,
          in general objects should not hold on to a "bucket" of capabilities
          which grant them authority, but hold on to them within specific
          contexts for specific purposes.
          In general, when an object is granted a capability, it is important
          that it know for what specific purpose it has been granted that
          capability so that it does not become confused and use it in the
          wrong scenario.
          This is not unlike how in computer programs a procedure called with
          specific arguments understands for what the meaning of those arguments
          are and for what they may be used.
        </p>
      </div>

      <!-- TODO: Insert Alyssa's example from the introduction -->

      <section id="delegation">
        <h2>Delegation through Proclamation Chains</h2>
        <p>
          <!-- TODO: Is parentProclamation too wordy? -->
          A proclamation MAY also have a <code>parentProclamation</code>
          property.
          A series of proclamations chained together in this way is called a
          "proclamation chain" and is how delegation of capabilities are
          handled in Linked Data Capabilities.
          New keys MAY be granted authority to use this proclamation through
          the associated <code>grantedKey</code> property.
          Proclamations with parents MUST NOT have a new <code>subject</code>
          property, and MUST be signed by either the original <code>subject</code>
          or one of the later <code>grantedKey</code> keys.
        </p>
      </section>

      <section id="caveats">
        <h2>Caveats</h2>
        <p>
          Every proclamation MAY add restrictions on the way the capability
          may be used by adding to the <code>caveat</code> property.
          Proclamations inherit the restrictions from all <code>caveat</code>
          properties of their parents, and MAY add new caveats in addition to
          those of their parents.
        </p>
        <p>
          The meaning of caveats are determined by their <code>type</code>
          and whatever other properties they have.
          Due to the way they are interpreted at invocation type by the
          <code>subject</code>, some mutual understanding of terminology
          must be understood between the entity adding a caveat and the
          subject evaluating (or any other parties observing) the invocation.
        </p>
      </section>

      <!-- TODO: move this to security considerations section:

           Unlike access control lists, the focus of capablities is about
           what action is being performed by who is "holding" a
           capability they have authority to use rather than checking who
           is performing a specific action every time an action is
           performed.

           @@: Or is this handled by the (non-)presence of grantedKeys
             note?
         -->
      </p>
    </section>

    <section id="invocation">
      <h2>Invocation</h2>

      <p>
        A capability may be enacted through the process of invocation.
        In the context of Linked Data Capabilities, an invocation
        consists of a linked data object which MUST have:
      </p>

      <ul>
        <li>
          the <code>type</code> of <code>Invocation</code>
          (composite types are permitted, but <code>Invocation</code>
          must be one)
        </li>
        <li>
          a <code>proclamation</code> property which links to the
          proclamation that grants authority to invoke this capability
        </li>
        <li>
          a <code>signature</code> property, which is a valid
          <a href="https://w3c-dvcg.github.io/ld-signatures/">
            Linked Data Signatures</a>
          entry signed by one of the keys granted by a
          <code>grantedKey</code> field from the proclamation chain.
        </li>
      </ul>

      <p>
        An invocation SHOULD have an <code>id</code> (which may also serve as a
        nonce).
        Any other properties are considered arguments to the invocation.
      </p>

      <p>
        In order for an invocation to be considered valid:
      </p>

      <ul>
        <li>
          The toplevel proclamation in the chain must be signed by
          one of the <code>subject</code>'s keys.
        </li>
        <li>
          <!-- @@: Or should it be the "nearest" grantedKey? -->
          All child proclamations must have a valid signature
          signed with one of the <code>grantedKey</code> fields
          of their parents.
        </li>
        <li>
          The restrictions of all caveats in the chain must be considered
          fulfilled.
        </li>
      </ul>

      <p>
        At this point, the invocation is considered valid and any relevant
        action may be performed.
        (This does not guarantee that a specific result will occur, merely that
        the invocation itself is valid; a subject could in evaluating the
        invocation encounter invalid input and return or raise an error, for
        instance.)
      </p>

      <div class="note">
        <p>
          Since invocations are themselves linked data documents, it is
          possible for an invocation to refer to an invocation as an argument.
          For this reason it is critical that mechanisms for accepting
          invocations be sure which invocation is being performed.
          For example, a mechanism that accepts linked data capabilities as
          JSON-LD documents will likely have no trouble telling which
          invocation is being performed since that will be the "top"
          of the framed document.
          However, a mechanism which accepted N-Quads would need additional
          information supplied perhaps in the headers in order to be able
          to determine the "root" of the invocation.
        </p>
      </div>

      <section id="methods">
        <h2>Methods</h2>

        <p>
          Methods are a common way to direct behavior of an invocation.
          Subjects are free to choose their own mechanisms for directing
          behavior, but MAY support the <code>method</code> property on
          invocations as one common bahavioral direction technique.
          The <code>method</code> property points to a URI as a form of
          vocabulary to determine which method is being performed.
          For example, a capability to a file storage system may allow
          for both reading and writing files, and a user could choose
          to set the <code>method</code> to
          <code>https://datastore.example/WriteFile</code>
          as an argument on their invocation.
        </p>

        <!-- TODO: Caveats which restrict to specific methods are fairly
             common.  Do we want to define such a caveat in this document? -->

      </section>
    </section>

    <!-- TODO: explore whether composition is fully supported by the
         current state of this document
       -->

  </body>
</html>
